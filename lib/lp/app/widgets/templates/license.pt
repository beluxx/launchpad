<tal:root
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  omit-tag="">
<script type="text/javascript"
        tal:condition="view/allow_pending_license">
//<![CDATA[
function license_chosen() {
  document.getElementById('license_pending').checked = false;
  document.getElementById('license_complete').checked = true;
}

function unset_licenses() {
  var checkboxes = document.getElementsByName('field.licenses');
  for (var i = 0; i < checkboxes.length; i++) {
    checkboxes[i].checked = false;
  }
}
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
// XXX: deryck 2011-02-09 bug=715892
// This stuff really needs a rewrite.  It is fragile
// and breaks with every YUI/lazr-js upgrade.
// Tread carefully, or else please make this better
// and add tests, too (preferably in reverse order there.)
YUI().use('node', 'lazr.effects', function(Y) {
    Y.on('domready', function() {
        function make_slider(cfg) {
            var table_name = '#' + cfg.which;
            var target_name = table_name + '-expand';
            var arrow_name = target_name + '-arrow';
            var target = Y.one(target_name);

            // Initialize the slider state.
            var table = Y.one(table_name);
            if (Y.Lang.isValue(table)) {
                // 2009-06-15 BarryWarsaw: For some reason nobody can explain,
                // this is required for animations to work properly.  Without
                // this, nothing happens!
                table.setStyle('display', 'block');

                // The table starts either collapsed or expanded.  The
                // animation lives on the link target.  The initial state of
                // the slider depends on whether there are any checked
                // licenses in that category.  A '0' means 'no'.
                var arrow = Y.one(arrow_name);
                if (arrow.getAttribute('start_expanded') == '0') {
                    target.slide = Y.lazr.effects.slide_in(table_name);
                }
                else {
                    // This is wrong on so many levels.  The view should
                    // set the classes such that the slider is initialized
                    // properly without requiring we run hiden animations.
                    //
                    // That is a largish refactor, so until that can happen,
                    // hard code the heights.  They cannot be determined with
                    // 'scrollHeight' because the elements are not visible.
                    var expanded_height;
                    if (cfg.which == 'more') {
                        expanded_height = 120;
                    } else {
                        expanded_height = 65;
                    }
                    target.slide = Y.lazr.effects.slide_out(
                        table_name, {to: {height: expanded_height}});
                }
                target.slide.stop();
                target.slide.run();

                // This event handler toggles the arrow state once the
                // animation is complete.  drawer_closed is an undocumented
                // attribute used by lazr-js, and recommended by mars.
                target.slide.on('end', function() {
                    var src;
                    if (this.drawer_closed) {
                        src = '/@@/treeCollapsed';
                    }
                    else {
                        src = '/@@/treeExpanded';
                    }
                    Y.one(arrow_name).setAttribute('src', src);
                });
            }

            // This is the event handler for clicking on the link or arrow.
            // It runs the slide animation, toggling between forward and
            // reverse.
            Y.on('click', function(e) {
                e.preventDefault();
                // We have to pass in the height by hand if the tables
                // are not visible when the page loads.
                var visible_on_load = !Y.one(
                    '#launchpad-form-widgets').hasClass('unseen');
                if (visible_on_load) {
                    target.slide.set('reverse', !target.slide.get('reverse'));
                } else {
                    var info_height = target.get(
                        'nextElementSibling').get('scrollHeight');
                    target.slide.set('to', {height: info_height});
                    target.slide.set('reverse', !target.slide.drawer_closed);
                }
                target.slide.stop();
                target.slide.run();
            }, target_name);
        }
        make_slider({which: 'copyright'});
        make_slider({which: 'recommended'});
        make_slider({which: 'more'});
        make_slider({which: 'deprecated'});
        make_slider({which: 'special'});

        // Set a click event handler for the div containing all the
        // license checkbox.  When any license checkbox is selected, the
        // "I haven't specified the license yet" radio button is set to
        // "This project consists of code licensed under:".  However note
        // that the pending-div only shows up if the project has never
        // selected a license.  In other cases, there's an "I don't know yet"
        // choice in the "Other choices" license section.
        var license_pending = Y.one('#license_pending');
        if (Y.Lang.isValue(license_pending)) {
            license_pending.on('click', reveal_details);

            var div = Y.one('#pending-div');
            if (Y.Lang.isValue(div)) {
                div.on('click', license_chosen);
            }
        }

        // When Other/Proprietary or Other/Open Source is chosen, the
        // license_info widget is displayed.
        var other_com = Y.one('input[value=OTHER_PROPRIETARY]');
        var other_os = Y.one('input[value=OTHER_OPEN_SOURCE]');
        var details = Y.one('#license-details');
        var proprietary = Y.one('#proprietary');

        function reveal_details(e) {
            if (other_com.get('checked') || other_os.get('checked')) {
                if (!details.hasClass('lazr-opened')) {
                    Y.lazr.effects.slide_out(details).run();
                }
            } else {
                if (!details.hasClass('lazr-closed')) {
                    Y.lazr.effects.slide_in(details).run();
                }
            }
            if (other_com.get('checked')) {
                if (!proprietary.hasClass('lazr-opened')) {
                    Y.lazr.effects.slide_out(proprietary).run();
                }
            } else {
                if (!proprietary.hasClass('lazr-closed')) {
                    Y.lazr.effects.slide_in(proprietary).run();
                }
            }
        }
        other_com.on('click', reveal_details);
        other_os.on('click', reveal_details);
        proprietary.removeClass('unseen');

        // Pre-reveal license_info widget.
        reveal_details(true);
    });
});
//]]>
</script>
<div style="color: black">
  <tal:copyright condition="view/source_package_release">
    <a href="" id="copyright-expand" class="js-action">
      <img id="copyright-expand-arrow"
            src="/@@/treeCollapsed"
            title="Copyright info from source package"
            alt="Copyright info from source package"
            start_expanded="0"/>
      Copyright info from source package
    </a>
    <div id="copyright">
      <div
        tal:content="structure view/source_package_release/@@+copyright"
        style="overflow-x: hidden; overflow-y: auto;
               max-width: 60em; max-height: 32em; background: #f7f7f7"
        />
    </div>
  </tal:copyright>

  Select the license(s) under which you release your project.
  <div tal:condition="view/allow_pending_license"
       tal:define="is_empty not:view/_getFormInput">
    <input id="license_pending" name="license_status" type="radio"
           tal:attributes="checked is_empty"
            onClick="unset_licenses()" />
    <label for="license_pending">I haven't specified the license yet</label>
    <br/>

    <input id="license_complete" name="license_status" type="radio"
          tal:attributes="checked not:is_empty" />
    <label for="license_complete">
      This project consists of code licensed under:
    </label>
  </div>

  <div id="pending-div" style="padding-left: 20px">
    <a href="" id="recommended-expand" class="js-action">
      <img id="recommended-expand-arrow"
           src="/@@/treeExpanded"
           title="Recommended open source licenses"
           alt="Recommended open source licenses"
           tal:attributes="start_expanded view/recommended_count"/>
      Recommended open source licenses
    </a>
    <input tal:replace="structure view/recommended" />
    <a href="" id="more-expand" class="js-action">
      <img id="more-expand-arrow"
           src="/@@/treeCollapsed"
           title="More open source licenses"
           alt="More open source licenses"
           tal:attributes="start_expanded view/more_count"/>
      More open source licenses
    </a>
    <input tal:replace="structure view/more" />
    <div tal:condition="view/deprecated_count">
      <a href="" id="deprecated-expand" class="js-action">
        <img id="deprecated-expand-arrow"
             src="/@@/treeCollapsed"
             title="Deprecated licenses"
             alt="Deprecated licenses"
             tal:attributes="start_expanded view/deprecated_count"/>
        Deprecated licenses
      </a>
      <input tal:replace="structure view/deprecated" />
    </div>
    <a href="" id="special-expand" class="js-action">
      <img id="special-expand-arrow"
           src="/@@/treeCollapsed"
           title="Other choices"
           alt="Other choices"
           tal:attributes="start_expanded view/special_count"/>
      Other choices
    </a>
    <input tal:replace="structure view/special" />
    <div id="license-details" style="margin-top: 10px">
      <label for="field.license_info">License details:</label>
      <input tal:replace="structure view/license_info_widget" />
      <p class="formHelp">Additional license details are required.
      Please include the URL to the license, its text, or other
      detailed information.</p>
   </div>
  </div>
  <p/>
    Launchpad.net is free to use for software projects that share
    their source code and comply with these
    <a tal:define="config modules/lp.services.config/config"
       tal:attributes="href config/commercial/licensing_policy_url">
      licensing policies.
    </a>
    <br/>
    <div id="proprietary" class="unseen">
      Commercial and proprietary projects do not qualify for free hosting;
      therefore a subscription needs to be purchased in order to host this
      project on Launchpad.
      <p>Here are the steps to obtain a commercial subscription:</p>
      <ol>
        <li>Purchase a Launchpad subscription in the
          <a tal:define="config modules/lp.services.config/config"
             tal:attributes="href config/commercial/purchase_subscription_url">
            Canonical Shop</a>.
        </li>
        <li>You will receive an email that your order has been processed.</li>
        <li>Then you may apply the purchased subscription to this project
            on your
          <a href="/people/+me/+vouchers"
             tal:attributes="href string:${request/lp:person/fmt:url}/+vouchers">
            voucher management page</a>.
        </li>
      </ol>
      <a href="mailto:commercial@launchpad.net">Contact us</a>
      for more information regarding commercial subscriptions.
    </div>
</div>
</tal:root>
